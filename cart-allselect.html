<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<style type="text/css">
			a{text-decoration: none;}
			.con{width: 980px;margin: 0 auto;}
			.sel_tr{height: 50px;line-height: 50px;color:#3c3c3c;margin-bottom: 10px;}
			.sel_all{width: 80px;}
			.sel_td{float: left;}
			.sel_td2{width: 302px;}
			.sel_tr .sel_td2 .inner_msg{padding-left: 91px;}
			.sel_td3,.sel_td4,.sel_td5{width:150px;text-align: center;}
			.sel_td4{height: 25px;text-align: center;}
			.sel_td4 .inner_msg{position: relative;overflow: hidden;}
			.sel_td4 .inner_msg .text{float: left;width: 39px;height: 15px;line-height: 15px; border: 1px solid #aaa;color: #343434;text-align: center;
    				padding: 4px 0;background-color: #fff;}
			.sel_td4 .inner_msg a{display:block;float: left;display: block; height: 23px;width: 17px; border: 1px solid #e5e5e5; background: #f0f0f0;
                      text-align: center;line-height: 23px;color: #444;}
			.sel_td label{margin: 0 10px 0 0;vertical-align: middle;width: 15px;height: 15px;border: 1px solid #ccc;display: inline-block;cursor: pointer;}
			label.truebg{background: url(img/more_unfold.png) no-repeat center;background-size: cover;}
			label.blankbg{background: #eee;}
			.sel_c{}
			.shop_t{width: 100%;height:38px;line-height: 38px;border-bottom: 1px solid #ccc;}
			.shop_b_list .sel_td{}
			.shop_b_list .sel_all{padding-top: 20px;margin-left: 10px;}
			.shop_b_list{min-height:80px;background: #efefef;border-bottom: 1px solid #ddd;}
			.shop_b_list .inner_msg{padding-top: 20px;}
			.jiesuan{height: ;background: #ccc;}
			.jian,.jiesuan .money,.sel_td5 .inner_msg{color:#f00;}
		</style>
	</head>
	<body>
		<div class="con">
			<div class="sel_tr clear">
				<div class="sel_td sel_all">
					<label for="" class="allchoice blankbg" onoff="true"></label> 全选
				</div>
				<div class="sel_td sel_td2">
					<div class="inner_msg">商品信息</div>
				</div>
				<div class="sel_td sel_td3">
					<div class="inner_msg">价格</div>
				</div>
				<div class="sel_td sel_td4">
					<div class="inner_msg">数量</div>
				</div>
				<div class="sel_td sel_td5">
					<div class="inner_msg">金额</div>
				</div>
			</div>
			<div class="sel_c">
				<div class="con_list">
					<div class="shop_t ">
						<div class="sel_td">
							<label for="" class="blankbg shop_btn" onoff="true"></label> 店铺：专卖店
						</div>
					</div>
					<div class="shop_b">
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label>
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">海俪恩SHE隐形近视眼镜眼睛美瞳药水大小瓶护理液500+120ml除蛋</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">212.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">212.00</span></div>
							</div>
						</div>
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label>
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">Dr.jart蒂佳婷V7维他命 白皙提亮淡斑控油素颜面霜 50ML</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">33.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">33.00</span></div>
							</div>
						</div>
					</div>
				</div>
				<div class="con_list">
					<div class="shop_t ">
						<div class="sel_td">
							<label for="" class="blankbg shop_btn" onoff="true"></label> 店铺：大是大非
						</div>
					</div>
					<div class="shop_b">
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">海俪恩SHE隐形近视眼镜眼睛美瞳药水大小瓶护理液500+120ml除蛋</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">43.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">43.00</span></div>
							</div>
						</div>
					</div>
					
				</div>
				<div class="con_list">
					<div class="shop_t ">
						<div class="sel_td">
							<label for="" class="blankbg shop_btn" onoff="true"></label> 店铺：受委屈
						</div>
					</div>
					<div class="shop_b">
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">海俪恩SHE隐形近视眼镜眼睛美瞳药水大小瓶护理液500+120ml除蛋</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">32.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">32.00</span></div>
							</div>
						</div>
					</div>
				</div>
				<div class="con_list">
					<div class="shop_t ">
						<div class="sel_td">
							<label for="" class="blankbg shop_btn" onoff="true"></label> 店铺：个人认识的
						</div>
					</div>
					<div class="shop_b clear">
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">海俪恩SHE隐形近视眼镜眼睛美瞳药水大小瓶护理液500+120ml除蛋</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">111.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">111.00</span></div>
							</div>
						</div>
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">大师但是犯得上房东是个特提供的发生的发多少人风热肉粉色热瓦苏大叔</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">212.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">212.00</span></div>
							</div>
						</div>
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">大师但是犯得上房东是个特提供的发生的发多少人风热肉粉色热瓦苏大叔</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">212.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">212.00</span></div>
							</div>
						</div>
					</div>
				</div>
				<div class="con_list">
					<div class="shop_t ">
						<div class="sel_td">
							<label for="" class="blankbg shop_btn" onoff="true"></label> 店铺：精英团队
						</div>
					</div>
					<div class="shop_b">
						<div class="shop_b_list clear">
							<div class="sel_td sel_all">
								<label for="" class="blankbg pin" onoff="true"></label> 
							</div>
							<div class="sel_td sel_td2">
								<div class="inner_msg">海俪恩SHE隐形近视眼镜眼睛美瞳药水大小瓶护理液500+120ml除蛋</div>
							</div>
							<div class="sel_td sel_td3">
								<div class="inner_msg">￥<span class="money">2.00</span></div>
							</div>
							<div class="sel_td sel_td4">
								<div class="inner_msg"><a class="min" href="javascript:;">-</a><input class="text" type="text" value="1" /><a class="add" href="javascript:;">+</a></div>
							</div>
							<div class="sel_td sel_td5">
								<div class="inner_msg">￥<span class="xiaoji">2.00</span></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="sel_tr jiesuan clear">
				<div class="sel_td sel_all">
					<label for="" class="allchoice blankbg" onoff="true"></label> 全选
				</div>
				<div class="sel_td sel_td2">
					<div class="inner_msg">已选择<span class="jian">0</span>件</div>
				</div>
				<div class="sel_td sel_td3">
					<div class="inner_msg">合计<span class="money">0.00</span>元</div>
				</div>
				<div class="sel_td sel_td4">
					<div class="inner_msg">结算</div>
				</div>
			</div>
		</div>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script type="text/javascript">
			$(function(){
				
				//页面开始加载时获取每个“小计” 的价格
				$(".shop_b_list").each(function(){
					var money=parseFloat($(this).find($(".money")).text())
					var num=parseInt($(this).find($(".text")).val())
					$(this).find($(".xiaoji")).text((money*num).toFixed(2))
				})
				//++ 点击+ 
				$(".add").click(function(){
					var val=$(this).parent().find(".text").val();
					var on=$(this).parent().parent().parent().find(".sel_td .pin").attr("onoff")
					var money=$(this).parent().parent().siblings(".sel_td3").find(".inner_msg .money").text();
					if(on=="false"){
						sum=parseFloat($(".jiesuan .money").text());
						sum+=Math.floor((money)*100)/100;
						sum=Math.floor(sum*100)/100;
					}
//					console.log(val,on,money)
					val++;
					if(val ==0 || val ==""){
						val=1;
					}
					$(".jiesuan .money").text(sum.toFixed(2))
					$(this).parent().find(".text").val(val)
					$(this).parent().parent().siblings(".sel_td5").find(".inner_msg .xiaoji").text((val*money).toFixed(2));
				})
				//-- 点击- 
				$(".min").click(function(){
					var val=$(this).parent().find(".text").val();
					var on=$(this).parent().parent().parent().find(".sel_td .pin").attr("onoff")
					var money=$(this).parent().parent().siblings(".sel_td3").find(".inner_msg .money").text();
					if(on=="false"){
						sum=parseFloat($(".jiesuan .money").text())
						if(val>1){
							sum-=Math.floor((money)*100)/100
						}
						sum=Math.floor(sum*100)/100
					}
					val--;
					if(val<1){
						val=1;
					}
					if(val ==0 || val ==""){
						val=1;
					}
					$(".jiesuan .money").text(sum.toFixed(2))
					$(this).parent().find(".text").val(val)
					$(this).parent().parent().siblings(".sel_td5").find(".inner_msg .xiaoji").text((val*money).toFixed(2));
				})
				//全选
				$(".allchoice").click(function(){
					var onoff=$(this).attr("onoff");
					if(onoff=="true"){
						sum=0,count=0;
						$(this).addClass("truebg").removeClass("blankbg");
						$(this).parent().parent().siblings().find(".sel_td .allchoice").addClass("truebg").removeClass("blankbg");
						$(this).parent().parent().siblings().find(".sel_td .allchoice").attr("onoff","false")
						$(this).parent().parent().siblings().children().find($(".shop_t .sel_td label")).addClass("truebg").removeClass("blankbg");
						$(this).parent().parent().siblings().children().find($(".shop_b .shop_b_list .sel_td label")).addClass("truebg").removeClass("blankbg");
						$(this).attr("onoff","false");
						$(this).parent().parent().siblings().children().find($(".shop_t .sel_td label")).attr("onoff","false");
						$(this).parent().parent().siblings().children().find($(".shop_b .shop_b_list .sel_td label")).attr("onoff","false");
						$(".jiesuan .jian").text($(this).parent().parent().siblings(".sel_c").find(".shop_b_list").length)
						$(".jiesuan .money").text(addPrice($(this).parent().parent().siblings(".sel_c").find(".shop_b_list")).toFixed(2))
					}else{
						$(this).removeClass("truebg").addClass("blankbg");
						$(this).parent().parent().siblings().find(".sel_td .allchoice").removeClass("truebg").addClass("blankbg");
						$(this).parent().parent().siblings().find(".sel_td .allchoice").attr("onoff","true")
						$(this).parent().parent().siblings().children().find($(".shop_t .sel_td label")).removeClass("truebg").addClass("blankbg");
						$(this).parent().parent().siblings().children().find($(".shop_b .shop_b_list .sel_td label")).removeClass("truebg").addClass("blankbg");
						$(this).attr("onoff","true");
						$(this).parent().parent().siblings().children().find($(".shop_t .sel_td label")).attr("onoff","true");
						$(this).parent().parent().siblings().children().find($(".shop_b .shop_b_list .sel_td label")).attr("onoff","true");
						$(".jiesuan .jian").text(0)
						$(".jiesuan .money").text(0)
					}
				})		
				//商铺全选
				$(".shop_btn").click(function(){
					var allshop;
					var nn=0;
					$(this).parent().parent().siblings(".shop_b").find(".shop_b_list .sel_td .pin").each(function(){
						if($(this).attr("onoff")=="false"){
							nn++;
						}
					})
					sum-=nn;
					count-=nn;
					console.log(nn,sum,count)
					var onoff=$(this).attr("onoff");
					if(onoff=="true"){
						$(this).addClass("truebg").removeClass("blankbg");
						$(this).parent().parent().siblings().children().find($(".sel_td label")).addClass("truebg").removeClass("blankbg");
						$(this).attr("onoff","false");
						$(this).parent().parent().siblings().children().find($(".sel_td label")).attr("onoff","false");
						sum+=addPrice($(this).parent().parent().siblings(".shop_b").find($(".shop_b_list")))
						count+=$(this).parent().parent().siblings(".shop_b").find($(".shop_b_list")).length;
//						console.log(count)
						//店铺全选
						var allele=$(this).parent().parent().parent().parent().children(".con_list").find(".shop_t .sel_td .shop_btn");
						allele.each(function(){
							var eleOff=$(this).attr("onoff");
							if(eleOff=="false"){
								allshop=true;
							}else{
								allshop=false;
								return false;
							}
						})
						if(allshop){
							$(".allchoice").addClass("truebg").removeClass("blankbg")
							$(".allchoice").attr("onoff","false")
						}
						$(".jian").text(count);
						$(".jiesuan .money").text(sum.toFixed(2))
					}else{
						count=$(this).parent().parent().siblings(".shop_b").find($(".shop_b_list")).length;
						count=$(".jiesuan .jian").text()-count;
						var qian=addPrice($(this).parent().parent().siblings(".shop_b").find($(".shop_b_list")))
						sum=parseFloat($(".jiesuan .money").text())-qian;
						$(this).removeClass("truebg").addClass("blankbg");
						$(this).parent().parent().siblings().children().find($(".sel_td label")).removeClass("truebg").addClass("blankbg");
						$(this).attr("onoff","true");
						$(this).parent().parent().siblings().children().find($(".sel_td label")).attr("onoff","true");
						$(".allchoice").removeClass("truebg").addClass("blankbg")
						$(".allchoice").attr("onoff","true")
						$(".jian").text(count);
						$(".jiesuan .money").text(sum.toFixed(2))
					}
				})
				var sum=0;
				var count=0;
				//价钱合计
				//obj=
				function addPrice(obj){
					var sum=0;
					obj.each(function(){
			       		sum=parseFloat(sum)+parseInt(parseFloat($(this).find(".sel_td5 .xiaoji").text()));
			       	})
//			       	sum=Math.floor(sum * 100) / 100
					return sum;
				}
				//选择商品
				$(".pin").click(function(){
					var shopchoice;
					var allshop;
					var val=$(this).parent().find(".text").val();
					var onoff=$(this).attr("onoff");
					if(onoff=="true"){
						count++;
						var money=$(this).parent().siblings(".sel_td5").find(".inner_msg .xiaoji").text();
						var numN=$(this).parent().siblings(".sel_td4").find(".inner_msg .text").val();
						sum+=addPrice($(this).parent().parent())
						$(this).addClass("truebg").removeClass("blankbg");
						$(this).attr("onoff","false");
						//商品全选则店铺选择
						var ele=$(this).parent().parent().parent().find(".shop_b_list .sel_td label");
						ele.each(function(){
							var eleOff=$(this).attr("onoff");
							if(eleOff=="false"){
								shopchoice=true;
							}else{
								shopchoice=false;
								return false;
							}
						})
						if(shopchoice){
							$(this).parent().parent().parent().siblings(".shop_t").children(".sel_td").find(".shop_btn").addClass("truebg").removeClass("blankbg");
							$(this).parent().parent().parent().siblings(".shop_t").children(".sel_td").find(".shop_btn").attr("onoff","false")
						}
						//店铺全选 allchoice全选
						var allele=$(this).parent().parent().parent().parent().parent().find(".con_list .shop_t .sel_td .shop_btn");
						allele.each(function(){
							var eleOff=$(this).attr("onoff");
							if(eleOff=="false"){
								allshop=true;
							}else{
								allshop=false;
								return false;
							}
						})
						if(allshop){
							$(this).parent().parent().parent().parent().parent().siblings(".sel_tr").find(".sel_td .allchoice").addClass("truebg").removeClass("blankbg")
							$(this).parent().parent().parent().parent().parent().siblings(".sel_tr").find(".sel_td .allchoice").attr("onoff","false")
						}
						$(".jian").text(count);
						$(".jiesuan .money").text(sum.toFixed(2))
						
					}else{
						count--;
						var qian=addPrice($(this).parent().parent());
						sum=parseFloat($(".jiesuan .money").text())-qian;
						console.log(sum)
						$(this).removeClass("truebg").addClass("blankbg");
						$(this).attr("onoff","true");
						$(this).parent().parent().parent().siblings(".shop_t").children(".sel_td").find(".shop_btn").removeClass("truebg").addClass("blankbg");
						$(this).parent().parent().parent().siblings(".shop_t").children(".sel_td").find(".shop_btn").attr("onoff","true")
						$(this).parent().parent().parent().parent().parent().siblings(".sel_tr").find(".sel_td .allchoice").removeClass("truebg").addClass("blankbg")
						$(this).parent().parent().parent().parent().parent().siblings(".sel_tr").find(".sel_td .allchoice").attr("onoff","true")
						$(".jian").text(count);
						$(".jiesuan .money").text(sum.toFixed(2))
					}
				})
			})
		</script>
	</body>
</html>
